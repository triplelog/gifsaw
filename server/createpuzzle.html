<!DOCTYPE html>

	
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gifsaw</title>
<meta name="description" content="."/>

<style>

</style>

</head>
<body>

<label for="npieces">Number of Pieces</label>
<input type="number" id="npieces" name="npieces"></input>

<label for="size">Size</label>
<select id="size">
</select>

<label for="nrows">Number of Rows</label>
<input type="number" id="nrows" name="nrows"></input>

<label for="ncols">Number of Columns</label>
<input type="number" id="ncols" name="ncols"></input>

<script>
var imageHeight = false;
var imageWidth = false;
var dimensions = [];
function updateNpieces() {
	var npieces = document.getElementById('npieces').value;
	var height = 1000;
	if(imageHeight){height = imageHeight;}
	var width = imageWidth || 1000;
	if(imageWidth){width = imageWidth;}
	dimensions = [];
	if (npieces <0){
		return;
	}
	
	let nrowsf = Math.floor(Math.sqrt(npieces*height/width));
	let ncolsf = Math.floor(nrowsf*width/height);

	
	//Find closest approximations
	var approxdimensions = [];
	var mind = npieces*2;
	if (nrowsf <3){nrowsf = 3;}
	if (ncolsf <3){ncolsf = 3;}
	for (var i=nrowsf-2;i<nrowsf+4;i++) {
		for (var ii=ncolsf-2;ii<ncolsf+4;ii++) {
			var nnpieces = i*ii;
			var npieceserr = Math.sqrt( (nnpieces-npieces)*(nnpieces-npieces)/(npieces*npieces) );
			var rat = ii/i;
			var raterr = Math.sqrt( (rat-width/height)*(rat-width/height)/((width/height)*(width/height)) );
			//var score = (raterr+.01) * Math.pow( npieceserr+.01, 2);
			var score = raterr + npieceserr*8;
			var dim = {nrows:i,ncols:ii,score:score};
			approxdimensions.push(dim);
		}
	}
	
	//Find nearest factors
	var exactdimensions = [];
	for (var i=1;i<npieces+1;i++) {
		if (npieces % i == 0){
			ii = npieces/i;
			var nnpieces = i*ii;
			var npieceserr = Math.sqrt( (nnpieces-npieces)*(nnpieces-npieces)/(npieces*npieces) );
			var rat = ii/i;
			var raterr = Math.sqrt( (rat-width/height)*(rat-width/height)/((width/height)*(width/height)) );
			//var score = (raterr+.01) * Math.pow( npieceserr+.01, 2);
			var score = raterr + npieceserr*8;
			var dim = {nrows:i,ncols:ii,score:score};
			exactdimensions.push(dim);
			
		}
	}
	exactdimensions.sort(function compare(a, b) {
	  if (a.score > b.score) return 1;
	  if (b.score > a.score) return -1;

	  return 0;
	});
	
	approxdimensions.sort(function compare(a, b) {
	  if (a.score > b.score) return 1;
	  if (b.score > a.score) return -1;

	  return 0;
	});
	dimensions = exactdimensions.slice(0,2);
	for (var iii in approxdimensions){
		var isRepeat = false;
		for (var iiii in dimensions){
			if (dimensions[iiii].nrows==approxdimensions[iii].nrows && dimensions[iiii].ncols==approxdimensions[iii].ncols){
				isRepeat = true;
			}
		}
		if (!isRepeat){
			dimensions.push(approxdimensions[iii]);
		}
		if (dimensions.length == 10){
			break;
		}
	}
	
	
	var el = document.getElementById('size');
	el.innerHTML = '';
	for (var i in dimensions){
		var option = document.createElement('option');
		option.value = dimensions[i].nrows+'x'+dimensions[i].ncols;
		option.textContent = dimensions[i].nrows+' x '+dimensions[i].ncols + ' ('+(dimensions[i].nrows*dimensions[i].ncols)+' pieces)';
		el.appendChild(option);
	}
	var option = document.createElement('option');
	option.value = 'custom';
	option.textContent = 'Custom';
	el.appendChild(option);
	updateSize();
	
}
function updateSize(evt) {
	if (evt && evt.target.id == 'nrows'){
		return;
	}
	else if (evt && evt.target.id == 'ncols'){
		return;
	}
	var el = document.getElementById('size');
	if (el.value == 'custom'){
		return;
	}
	var dim = el.value.split('x');
	var nrows = parseInt(dim[0]);
	var ncols = parseInt(dim[1]);
	document.getElementById('nrows').value = nrows;
	document.getElementById('ncols').value = ncols;
	
}
document.getElementById('npieces').addEventListener('change',updateNpieces);
document.getElementById('size').addEventListener('change',updateSize);
</script>
</body>


	</html>





